syntax = "proto3";

package story;

// 文本来源枚举
enum Source {
  TEXT = 0;        // 原文
  AUDIO = 1;       // 音频转写
  TRANSLATION = 2; // 翻译
}

// 文本段落
message TextSegment {
  string id = 1;           // 段落ID
  string content = 2;      // 文本内容
  Source source = 3;       // 来源类型
  float confidence = 4;    // 置信度 (0-1)
  int64 timestamp = 5;     // 时间戳
}

// 语言包
message LanguagePack {
  string lang = 1;                    // 语言代码 (en, zh, etc.)
  repeated TextSegment segments = 2;   // 文本段落列表
  int32 total_segments = 3;           // 总段落数
  float average_confidence = 4;       // 平均置信度
}

// 故事包 (根消息)
message StoryPack {
  string story_name = 1;              // 故事名称
  repeated LanguagePack languages = 2; // 多语言包
  int64 created_at = 3;               // 创建时间戳
  int64 updated_at = 4;               // 更新时间戳
  string version = 5;                 // 版本号
  map<string, string> metadata = 6;   // 元数据
}

// 查询请求
message QueryRequest {
  string story_name = 1;   // 故事名称
  string lang = 2;         // 语言代码
  string text_id = 3;      // 文本ID
  Source source = 4;       // 来源类型
}

// 查询响应
message QueryResponse {
  string content = 1;      // 文本内容
  float confidence = 2;    // 置信度
  int64 timestamp = 3;     // 时间戳
  bool found = 4;          // 是否找到
  string error_message = 5; // 错误信息
}

// 批量查询请求
message BatchQueryRequest {
  repeated QueryRequest queries = 1;
}

// 批量查询响应
message BatchQueryResponse {
  repeated QueryResponse responses = 1;
  int32 total_queries = 2;
  int32 successful_queries = 3;
  int32 failed_queries = 4;
} 